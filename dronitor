#!/usr/bin/env python2

from subprocess import call
import click
import time
from scapy.all import *
import pyshark
from dict import channelFrequencies, phyTypes
from helper import changeToMonitorMode, changeFrequency, captureBeacons, changeToManagedMode, findSSID

@click.group()
def cli():
	pass

@cli.command()
@click.option('-c', '--channel', default=1, help="Wifi channel number to listen on")
@click.argument('interface')
def static(interface, channel):

	changeToMonitorMode(interface)
	changeFrequency(interface, channel)
	captureBeacons(interface)

@cli.command()
@click.argument('interface')
def hop(interface):
	changeToMonitorMode(interface)
	while True:
		try:
			for key in sorted(channelFrequencies.keys()):
				changeFrequency(interface, key)
				time.sleep(0.5)	
				sniff(iface=interface, prn=findSSID, timeout=1)
		except (RuntimeError) as error:
			click.secho('Exited program', fg="cyan")		

@cli.command()
@click.argument('interface')
def managed(interface):
	changeToManagedMode(interface)


if __name__ == '__main__':
	cli()